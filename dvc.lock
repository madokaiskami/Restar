schema: '2.0'
stages:
  freeze_data:
    cmd: python -m restar.prepare --config configs/data_frozen.yaml
    deps:
    - path: configs/data_frozen.yaml
      hash: md5
      md5: 1abf2841997db032a6aa86e09589e071
      size: 1256
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/prepare.py
      hash: md5
      md5: 020322ace2dab0b3b92b27d8ef50741d
      size: 6860
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    outs:
    - path: data/frozen/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/frozen/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: data/frozen/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
  prepare:
    cmd: python -m restar.prepare --config configs\dvc_full.yaml
    deps:
    - path: configs\dvc_full.yaml
      hash: md5
      md5: b19ad212d11f61a093155ec449b747d0
      size: 1577
    - path: data/frozen/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/frozen/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: data/frozen/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/prepare.py
      hash: md5
      md5: 020322ace2dab0b3b92b27d8ef50741d
      size: 6860
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs\dvc_full.yaml
    outs:
    - path: data/raw/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/raw/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: data/raw/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
  train:
    cmd: python -m restar.train --config configs\dvc_full.yaml
    deps:
    - path: artifacts/pretrained/model/
      hash: md5
      md5: ffc48bc6c002dbb491cee0a76d52cb1b.dir
      size: 268780664
      nfiles: 7
    - path: configs\dvc_full.yaml
      hash: md5
      md5: b19ad212d11f61a093155ec449b747d0
      size: 1577
    - path: data/raw/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/raw/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/train.py
      hash: md5
      md5: b01600b0935cb730539574452e35d635
      size: 34420
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs\dvc_full.yaml
    outs:
    - path: outputs/dvc_run/metrics_dev.json
      hash: md5
      md5: e7f27862e74218f77ac48ae0463fd4fc
      size: 431
    - path: outputs/dvc_run/model
      hash: md5
      md5: 7695ddfe64502e117fbe7f68e92170fc.dir
      size: 268787203
      nfiles: 7
    - path: outputs/dvc_run/train.log
      hash: md5
      md5: ce8b6762d7ac5f0bfacc9aec0f0eab22
      size: 134
  evaluate:
    cmd: python -m restar.evaluate_dataset --config configs\dvc_full.yaml
    deps:
    - path: configs\dvc_full.yaml
      hash: md5
      md5: b19ad212d11f61a093155ec449b747d0
      size: 1577
    - path: data/raw/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: outputs/dvc_run/model
      hash: md5
      md5: 7695ddfe64502e117fbe7f68e92170fc.dir
      size: 268787203
      nfiles: 7
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/evaluate_dataset.py
      hash: md5
      md5: 453a8db069946b890f45d30770998122
      size: 4728
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs\dvc_full.yaml
    outs:
    - path: outputs/dvc_run/confusion_matrix.png
      hash: md5
      md5: bd3d99d630d33d16b36e9c2aaa2045f2
      size: 23502
    - path: outputs/dvc_run/metrics_eval.json
      hash: md5
      md5: 39598b91065bf323dc88dccb377527f1
      size: 460
  fetch_model:
    cmd: python -m restar.fetch_pretrained --config configs\dvc_full.yaml
    deps:
    - path: configs\dvc_full.yaml
      hash: md5
      md5: b19ad212d11f61a093155ec449b747d0
      size: 1577
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/fetch_pretrained.py
      hash: md5
      md5: 2fb2f04b89ff6d1f6679614b49654b39
      size: 2961
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs\dvc_full.yaml
    outs:
    - path: artifacts/pretrained/model/
      hash: md5
      md5: ffc48bc6c002dbb491cee0a76d52cb1b.dir
      size: 268780664
      nfiles: 7
  export_torchserve:
    cmd: python tools/export_torchserve.py --model_dir outputs/dvc_run/model 
      --artifacts_dir torchserve/artifacts --model_store torchserve/model-store 
      --handler torchserve/handler.py
    deps:
    - path: configs\dvc_full.yaml
      hash: md5
      md5: b19ad212d11f61a093155ec449b747d0
      size: 1577
    - path: outputs/dvc_run/model/
      hash: md5
      md5: 7695ddfe64502e117fbe7f68e92170fc.dir
      size: 268787203
      nfiles: 7
    - path: tools/export_torchserve.py
      hash: md5
      md5: 5fcc971010597c5c97980d59c0264bd5
      size: 3542
    - path: torchserve/handler.py
      hash: md5
      md5: 8efd40baaec76a930316cae97ad7f7ba
      size: 3364
    params:
      params.yaml:
        restar.dvc_config: configs\dvc_full.yaml
    outs:
    - path: torchserve/artifacts/model.pt
      hash: md5
      md5: b23c60d09cf716d1775f12eff3c5ea07
      size: 267856723
    - path: torchserve/model-store/mymodel.mar
      hash: md5
      md5: 10835c4a205ca9dd091f70ec2e4a0dd4
      size: 247324790
