schema: '2.0'
stages:
  freeze_data:
    cmd: python -m restar.prepare --config configs/data_frozen.yaml
    deps:
    - path: configs/data_frozen.yaml
      hash: md5
      md5: 1abf2841997db032a6aa86e09589e071
      size: 1256
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/prepare.py
      hash: md5
      md5: 020322ace2dab0b3b92b27d8ef50741d
      size: 6860
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    outs:
    - path: data/frozen/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/frozen/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: data/frozen/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
  prepare:
    cmd: python -m restar.prepare --config configs/dvc_smoke.yaml
    deps:
    - path: configs/dvc_smoke.yaml
      hash: md5
      md5: 30c26e9ff2717cfbbd60345875a4ef58
      size: 794
    - path: data/frozen/dev.parquet
      hash: md5
      md5: 7227132ca19bb6f40c5b5e3354da37be
      size: 71451701
    - path: data/frozen/eval.parquet
      hash: md5
      md5: af9268a02b9864e83d2f6eaf064063c6
      size: 213440239
    - path: data/frozen/train.parquet
      hash: md5
      md5: 3154106e052c2fee90662d3282e4af8d
      size: 59874966
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/prepare.py
      hash: md5
      md5: 020322ace2dab0b3b92b27d8ef50741d
      size: 6860
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs/dvc_smoke.yaml
    outs:
    - path: data/raw/dev.parquet
      hash: md5
      md5: 941087de38c8a70e65fd5b3f6ebbace0
      size: 51490
    - path: data/raw/eval.parquet
      hash: md5
      md5: c1c36aa754aca0d4b08fc8105a33dc74
      size: 55490
    - path: data/raw/train.parquet
      hash: md5
      md5: 0fe8090e4963d1e0ecdeb223f12ab412
      size: 76049
  train:
    cmd: python -m restar.train --config configs/dvc_smoke.yaml
    deps:
    - path: artifacts/pretrained/model/
      hash: md5
      md5: b00f4dd3b1f901ae71cff7f134a4c1f2.dir
      size: 18495004
      nfiles: 7
    - path: configs/dvc_smoke.yaml
      hash: md5
      md5: 30c26e9ff2717cfbbd60345875a4ef58
      size: 794
    - path: data/raw/dev.parquet
      hash: md5
      md5: 941087de38c8a70e65fd5b3f6ebbace0
      size: 51490
    - path: data/raw/train.parquet
      hash: md5
      md5: 0fe8090e4963d1e0ecdeb223f12ab412
      size: 76049
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/train.py
      hash: md5
      md5: b01600b0935cb730539574452e35d635
      size: 34420
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs/dvc_smoke.yaml
    outs:
    - path: outputs/dvc_run/metrics_dev.json
      hash: md5
      md5: ae1d3bbd8212e20059cb90345f580432
      size: 397
    - path: outputs/dvc_run/model
      hash: md5
      md5: aa594a13bbc4715c2f537004dbdc8408.dir
      size: 18501543
      nfiles: 7
    - path: outputs/dvc_run/train.log
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
  evaluate:
    cmd: python -m restar.evaluate_dataset --config configs/dvc_smoke.yaml
    deps:
    - path: configs/dvc_smoke.yaml
      hash: md5
      md5: 30c26e9ff2717cfbbd60345875a4ef58
      size: 794
    - path: data/raw/eval.parquet
      hash: md5
      md5: c1c36aa754aca0d4b08fc8105a33dc74
      size: 55490
    - path: outputs/dvc_run/model
      hash: md5
      md5: aa594a13bbc4715c2f537004dbdc8408.dir
      size: 18501543
      nfiles: 7
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/data.py
      hash: md5
      md5: ae9bb677599572b81d47bd4f1c42bf0c
      size: 15410
    - path: src/restar/evaluate_dataset.py
      hash: md5
      md5: 453a8db069946b890f45d30770998122
      size: 4728
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs/dvc_smoke.yaml
    outs:
    - path: outputs/dvc_run/confusion_matrix.png
      hash: md5
      md5: 5909582b1500a860af5831ef3db529f5
      size: 12699
    - path: outputs/dvc_run/metrics_eval.json
      hash: md5
      md5: 34ee2e8644b40bfe50450b26382026fc
      size: 421
  fetch_model:
    cmd: python -m restar.fetch_pretrained --config configs/dvc_smoke.yaml
    deps:
    - path: configs/dvc_smoke.yaml
      hash: md5
      md5: 30c26e9ff2717cfbbd60345875a4ef58
      size: 794
    - path: src/restar/config.py
      hash: md5
      md5: 6b97eefa0034a860485e75d8670fb130
      size: 605
    - path: src/restar/fetch_pretrained.py
      hash: md5
      md5: 2fb2f04b89ff6d1f6679614b49654b39
      size: 2961
    - path: src/restar/utils.py
      hash: md5
      md5: 7f8b0abfa17ed7075d1dc01b0bb6b91e
      size: 5872
    params:
      params.yaml:
        restar.dvc_config: configs/dvc_smoke.yaml
    outs:
    - path: artifacts/pretrained/model/
      hash: md5
      md5: b00f4dd3b1f901ae71cff7f134a4c1f2.dir
      size: 18495004
      nfiles: 7
  export_torchserve:
    cmd: python tools/export_torchserve.py --model_dir outputs/dvc_run/model 
      --artifacts_dir torchserve/artifacts --model_store torchserve/model-store 
      --handler torchserve/handler.py
    deps:
    - path: configs/dvc_smoke.yaml
      hash: md5
      md5: 30c26e9ff2717cfbbd60345875a4ef58
      size: 794
    - path: outputs/dvc_run/model/
      hash: md5
      md5: aa594a13bbc4715c2f537004dbdc8408.dir
      size: 18501543
      nfiles: 7
    - path: tools/export_torchserve.py
      hash: md5
      md5: 5fcc971010597c5c97980d59c0264bd5
      size: 3542
    - path: torchserve/handler.py
      hash: md5
      md5: 8efd40baaec76a930316cae97ad7f7ba
      size: 3364
    params:
      params.yaml:
        restar.dvc_config: configs/dvc_smoke.yaml
    outs:
    - path: torchserve/artifacts/model.pt
      hash: md5
      md5: 4d1cf89c0d5ac04aa8fa6cdb6eca270c
      size: 17558922
    - path: torchserve/model-store/mymodel.mar
      hash: md5
      md5: e7a31e74e6750623651bc881e11d7f21
      size: 16584351
